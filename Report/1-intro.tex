% !TeX root = ./report.tex

GUI（图形用户接口）技术从最早的 WCF、WinForm 到现在原生跨平台的 Qt、Electron 一直是一个经久不衰的话题。举例来说，Google 最近正在大力推广他的新技术 Flutter，可以快速在 iOS 和 Android 上构建高质量的原生用户界面。究其风靡工业界学术界的原因，是因为一个用户体验良好的 GUI 应用本身十分复杂，各领域的开发者都想要创造某种范式\cite{url:uiArchs}来进行简化。然而不管如何创造新控件、创造新 DSL（领域特定语言），每个用例的逻辑细节都是需要人来手工输入的，这就导致了其代码复杂度基本不可能降低。

WPF、Qt 等框架的出现和热门的原因十分明显：不同于花大力气直接查阅调用系统 API（参考 WCF 开发），这些封装好的 GUI 技术可以大大缩短开发/调试时间，而且有的还能做到跨平台。

然而，世上没有绝对完美的技术，GUI 开发也是如此：Qt 的 slot 模式十分方便，使用 C++ 也十分高效，但是一个 Hello world 都要带上几十 M 的 qt5.dll（尽管可以通过一系列操作将这个数字缩小到 2.5），开发难度完全由开发者写 C++ 的熟练度（众所周知 C++ 是最难 Debug 的语言之一）决定。WPF 的 MVVM 模式虽然自称优秀，但是要在其架构下编写良构的代码并不容易，更别提他还推荐把代码逻辑都写成 Binding；另外由于他是基于 .Net 平台，内存分配基本上就是个笑话，任何一次频繁的字符串操作就要瞬间吃掉大量内存。Electron 等利用网页开发的技术可以说是相当便宜了（指学习难度），然而每次启动程序都是启动一次浏览器的成本属实高昂。

本章会介绍开发基于 WPF 的 AGV 地图编辑器的背景，然后介绍本软件的主要功能以及使用方法，最后介绍开发意义和 WPF 和 AGV 的一些问题。

\section{开发背景}

随着工业技术的发展，各类机器人渐渐代替了大量手工作业。我国 AGV 机器人在各项政策的保驾护航下，迅速占领着大量市场份额。《2018 -- 2023年中国仓储物流行业市场前瞻与投资战略规划分析报告》数据\cite{url:20180131C02LR0}显示，我国对 AGV 机器人的需求增长迅速，基本上集中在应用领域。

\begin{figure}[H]
  \centering
  \includegraphics[width=0.618\textwidth]{assets/bar.pdf}
  \caption{2013 -- 2018 年中国 AGV 机器人销量（单位：台）}
  \label{fig:figure1}
\end{figure}

计算机技术的飞速发展，带动了一系列传统行业的转型升级。例如制造业常用的叉车，就会被 AGV 甚至 AMR（自主移动机器人）替代。同时，GUI 软件的发展，让更多非专业的用户也能轻松使用工具完成机器人行为的设定。复杂的数据格式，将以可视化的形式展现在用户面前，不费吹灰之力就可以在有限的操作方式下进行编辑。

\section{研究现状}

下面主要对 AGV 导引技术和 GUI 开发技术两者分别进行表述。

AGV 导引技术在多年的技术沉淀下，已经趋于成熟。主要分为固定和自由路线的导引方式。一方面，人们使用电磁感应或者其他传感器来实现固定线路的导引，由于这里面都是机械装置而不存在智能设备，因此批量制造和应用都比较容易。这种方式的缺陷是每条固定线路都要专门打造电缆以及产生可变电流的装置，自由度低且复杂性有限。难以扩展或更改路线，容易被磁铁等物质干扰等。另一方面，人们尝试使用激光、视觉识别等``高科技''方式进行自由路线识别导引。在外国已经有产业化的激光导引装置，其优点是识别精确、能适应各种复杂的工作环境和地形。缺点是比较昂贵，难以大量生产使用。更多的导引装置如惯性、超声波、磁钉等都是基于上面两种的推广或融合。人们的最终目标都是研制出高性价比的导引传感器或类似技术。

GUI 技术自从有屏幕的计算机被发明以来就一直在蓬勃发展。一开始只是借用语言特性对系统 API 进行封装（WTL，MFC）；后来 GTK 提出了 Layout、Signal/Slot 的先进概念，现在还可以在很多软件中看到；再后来各个框架都开始往自己的道路上发展，如 Qt 完成了对所有支持平台的 API 的封装、WPF 使用了强大的 XAML 工具来定义自己的界面、Cocoa 则拿出了所见即所得的严格 MVC。这里还要提一下 Delphi，是一个基于 Pascal 的 RAD（快速应用开发）工具，后来因为 Pascal 的没落和研发失败，渐渐淡出了现代程序员的视野。

同时，人们发现了浏览器——一个经过精心优化的 UI 渲染引擎。单从自定义特效的性能上而言，不管是 Qt、WPF 还是什么都难以和 Chrome/Firefox 比肩。而 NodeJS 的崛起，不仅催生了``前端程序员''这样的职业，也让浏览器获得了调用系统 API 的能力。NW.js/Electron 等新兴平台开始占据 GUI 开发的主导地位。这使得开发 GUI 的成本大大下降，而且可以跨平台。关键是可以免费享受到前端技术的种种发展，如 React、Vue 等。因此，现在之前提到的那几种框架里面大都含一个``WebView''控件。而富客户端也渐渐往云计算方向靠拢，目的也是为了解放网络的生产力，云计算同时也成了大数据等研究热点的温室。最近 NVIDIA 还推出了云游戏——直接将游戏放在云服务器上运行，然后依赖网速将游戏画面实时传输到用户主机，在我看来也是未来 GUI 发展的一种可能吧。

\section{主要功能概述}

本次毕业设计是基于 WPF 的地图编辑软件，其编辑的地图数据主要由坐标点和路线构成。由于其领域特定元素，本软件并不需要支持用户、权限、分布式运算等功能。首先要支持的是连接到本地数据库并从中读取地图数据。然后用户可以通过双击空白区域创建新的坐标点，坐标点的属性除了 XY 坐标外都默认初始化为 0 或空。双击坐标点可以对它的所有属性进行编辑，例如添加一条到另一个坐标点的路线。按住右键拖动画布可以方便编辑范围更大的数据。按 Delete 键可以删掉之前选中或刚创建的点。同时为了操作方便，光标会``吸附''到和其他坐标点对齐的位置，如果不需要对齐可以按住 Ctrl 键。最后也是最重要的一个功能是一旦对视图产生了更改，就会显示一个``保存''按钮，点击可以立即将当前更新的地图保存到数据库。

\section{本次研究的意义}

AGV 作为时下工业界热门机械，其开发前景和意义不言而喻。在日新月异的信息时代，任何人或企业都在尽力追赶潮流的步伐，改革创新，才能在社会中独善其身。传统的叉车机械虽然体量庞大，但是终究是过去式了。AGV 作为新兴载具，必然会逐步变得廉价和可以民用。在这个时间点研究 AGV 的相关内容再合适不过了，尽管现在有更新的技术提出，不过还有待时间检验。

GUI 作为经久不衰的研究热点，无数公司、无数平台给出了无数的答卷。GUI 作为一个通用人机交互接口，满足了大量非专业人员的操作需求，也为 AGV 等专用设备打开了普及民用的大门。现在高级的 AGV 机器人已经不满足于仅仅通过电脑屏幕来操作，而是引入了``人机协作''的概念，只要员工领着机器人到场地走一圈就可以令其记住自己的路线，可以说是相当方便了。总之，在一切趋于智能化的今天，只要屏幕存在，GUI 的需求就不会消失。在任何时候研究 GUI 的意义都是存在的。

着眼未来，前文提到 WPF 等传统 GUI 存在种种缺陷，例如内存占用过大、自定义能力不足等。不出意外的话，未来的大部分 GUI 软件将会和 Web 前端技术充分结合。本次毕业设计中，有些难以实现的特性我就直接跳过或绕过了，这不得不说是个缺憾。如果本软件还有二次开发的需求的话，我个人建议是采用 Web 应用或者类似方式来实现用户界面，一来现在前端人口众多，开源库丰富；二来二次开发的成本更低，相同的需求可以用更直观简单的代码来实现。总的来说，单纯的 XAML 式 GUI 设计已经很难满足人们日益复杂的需求（更难满足的是提需求的人并不觉得自己的需求复杂），而且开发运行成本更高。本次毕业设计由于只是小型软件，外加对源码 100\% C\# 的追求，才这么实现的，实际开发中这么操作更多的是吃力不讨好，拥抱未来才是正道。
